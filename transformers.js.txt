import { pipeline, env } from "@huggingface/transformers";

const init = () => {
  console.log("navigator.gpu:", !!navigator.gpu);

  if (!!navigator.gpu) {
    env.backends.onnx.defaultExecutionProvider = "webgpu";
    console.log("âœ… Using WebGPU backend");
  } else {
    env.backends.onnx.defaultExecutionProvider = "wasm";
    console.warn("âš ï¸ WebGPU not available â€” using WASM backend (CPU)");
  }

  env.allowLocalModels = true;
  env.useBrowserCache = true;

  if (env.backends.onnx?.wasm?.proxy) env.backends.onnx.wasm.proxy = true;
  if (env.backends.onnx?.wasm?.numThreads) env.backends.onnx.wasm.numThreads = 1;
  if (env.logLevel) env.logLevel = "verbose";

  console.log("ðŸ§  Transformers environment initialized!");
}


init();
const _detector = pipeline("object-detection", "Xenova/detr-resnet-50");
// "Xenova/yolos-tiny"
// 'Xenova/detr-resnet-50'
// "Xenova/ssd-mobilenet-v1"




const drawFrame = () => {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  ctx.strokeRect(20, 25, 100, 40);
  requestAnimationFrame(drawFrame);
}

drawFrame();